<!DOCTYPE html>
<html class="dark" lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Đăng nhập vào Bảng điều khiển Quản trị</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
    </style>
  </head>

  <body class="font-display">
    <div
      class="relative flex min-h-screen w-full flex-col items-center justify-center bg-background-light dark:bg-background-dark overflow-x-hidden p-4"
    >
      <div
        class="flex w-full max-w-4xl rounded-xl shadow-2xl overflow-hidden bg-white dark:bg-gray-900/50"
      >
        <!-- Left Side - Form -->
        <div class="w-full lg:w-1/2 p-8 sm:p-12 flex flex-col justify-center">
          <div class="flex items-center gap-3 mb-6">
            <div class="bg-primary p-2 rounded-lg">
              <span class="material-symbols-outlined text-white text-2xl"
                >shield_person</span
              >
            </div>
            <h1 class="text-xl font-bold text-gray-800 dark:text-white">
              Admin Panel
            </h1>
          </div>

          <div class="flex flex-wrap justify-between gap-3 mb-6">
            <p
              class="text-gray-900 dark:text-white text-4xl font-black leading-tight w-full"
            >
              Đăng nhập vào Bảng điều khiển Quản trị
            </p>
          </div>

          <!-- form không submit trực tiếp (JS sẽ gọi API /api/account/login) -->
          <form
            id="loginForm"
            class="flex flex-col gap-4"
            onsubmit="return false;"
          >
            <label class="flex flex-col w-full">
              <p
                class="text-gray-700 dark:text-gray-300 text-base font-medium leading-normal pb-2"
              >
                Tên đăng nhập (email)
              </p>
              <div class="relative flex w-full items-stretch">
                <span
                  class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"
                  >person</span
                >
                <input
                  id="email"
                  name="email"
                  type="email"
                  required
                  class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 h-14 pl-12 pr-4"
                  placeholder="Nhập email của bạn"
                />
              </div>
            </label>

            <label class="flex flex-col w-full">
              <p
                class="text-gray-700 dark:text-gray-300 text-base font-medium leading-normal pb-2"
              >
                Mật khẩu
              </p>
              <div class="relative flex w-full items-stretch">
                <span
                  class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"
                  >lock</span
                >
                <input
                  id="pass"
                  name="pass"
                  type="password"
                  required
                  class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 h-14 pl-12 pr-12"
                  placeholder="Nhập mật khẩu của bạn"
                />
              </div>
            </label>

            <p
              id="errorBox"
              class="hidden flex items-center gap-2 bg-error/10 text-error p-3 rounded-lg mt-2"
            >
              <span class="material-symbols-outlined text-xl">error</span>
              <span id="errorText" class="text-sm font-medium"></span>
            </p>

            <button
              id="submitBtn"
              class="flex w-full items-center justify-center rounded-lg h-14 px-6 text-base font-bold leading-normal text-white bg-primary hover:bg-primary/90 mt-4"
            >
              Đăng nhập
            </button>
          </form>
        </div>

        <!-- Right Side - Image -->
        <div
          class="hidden lg:flex w-1/2 bg-gray-100 dark:bg-background-dark p-4"
        >
          <div
            class="w-full h-full bg-center bg-no-repeat bg-cover rounded-xl"
            style="
              background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCuHy7mllRa-6EigYl2Bwmw4eOZFF751qSfYAr3bjFEv2hnvzPPR7VushO0KEe4H9AKm3P3qwgGYQUbQjuLgkFUvse3J2NrAyhkaQlZRfe4v1sqNVXNoF-3pjDZJPOq2RridTe2K1pjBNq4P95tXRhKlEPiNFfI6gezJ3tr3IQoUHjcUl_h7O4o0B-WxbJ_ZBbBctSU2eNawkoup55JkGRTyDJciF1pNHxKUIdUHwgbw1JYVkJd572j-WAsqZ-IVbgWk_EbQ03LMjw');
            "
          ></div>
        </div>
      </div>
    </div>

    <script>
      const loginForm = document.getElementById("loginForm");
      const errorBox = document.getElementById("errorBox");
      const errorText = document.getElementById("errorText");
      const submitBtn = document.getElementById("submitBtn");

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorBox.classList.add("hidden");
        submitBtn.disabled = true;
        submitBtn.textContent = "Đang kiểm tra...";

        const email = document.getElementById("email").value.trim();
        const pass = document.getElementById("pass").value;

        try {
          const res = await fetch("/api/account/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, pass }),
          });

          const data = await res.json().catch(() => ({}));

          if (res.ok) {
            // server trả: { message: 'Login successful', data: { user, token } }
            const token = data?.data?.token;
            const user = data?.data?.user;
            if (token) {
              // Lưu token để dùng cho các request API tiếp theo
              localStorage.setItem("auth_token", token);
              localStorage.setItem("auth_user", JSON.stringify(user));

              // chuyển trang vào dashboard (bạn có thể đổi URL sang /admin hoặc khác)
              window.location.href = "/admin"; // chỉnh theo route dashboard bên bạn
              return;
            } else {
              errorText.textContent = "Không nhận được token từ server.";
              errorBox.classList.remove("hidden");
            }
          } else {
            // hiển thị lỗi từ server (error field hoặc message)
            const msg = data?.error || data?.message || "Đăng nhập thất bại";
            errorText.textContent = msg;
            errorBox.classList.remove("hidden");
          }
        } catch (err) {
          console.error(err);
          errorText.textContent = "Lỗi mạng hoặc server. Vui lòng thử lại.";
          errorBox.classList.remove("hidden");
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Đăng nhập";
        }
      });
    </script>
  </body>
</html>
